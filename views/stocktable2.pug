extends layout2.pug  

block content 
  div(style="width: 100%; height: 100vh; display: flex; flex-direction: row;")
    div(style="width: 25%; height: 100%;")
      include includes/sidebar.pug

    div(style="width: 75%; padding: 20px; overflow-y: auto;")
      .container.my-5.mt-6
        //- Flash messages
        if success_msg && success_msg.length
          .alert.alert-success.alert-dismissible.fade.show(role='alert' id='flashMsg')
            | #{success_msg[0]}
            button.btn-close(type='button' data-bs-dismiss='alert' aria-label='Close')
        if error_msg && error_msg.length
          .alert.alert-danger.alert-dismissible.fade.show(role='alert' id='flashMsg')
            | #{error_msg[0]}
            button.btn-close(type='button' data-bs-dismiss='alert' aria-label='Close')

        h3 Stock Records

        //- Filter buttons
        .mb-4.text-center
          button.btn.btn-outline-dark.btn-sm.me-2(data-filter="All") All
          button.btn.btn-outline-dark.btn-sm.me-2(data-filter="Wood") Wood Products
          button.btn.btn-outline-dark.btn-sm(data-filter="Furniture") Furniture

        .d-flex.justify-content-between.align-items-center.mb-3
          input.form-control.w-25(type="text" id="searchInput" placeholder="Search...")
          a.btn.btn-dark(href='/stock') Add New Stock

        table.table.table-striped.table-bordered#stockTable
          thead.table-dark
            tr
              th(scope='col') Product Name
              th(scope='col') Product Type
              th(scope='col') Quantity 
              th(scope='col') Cost Price (UGX)
              th(scope='col') Product Price (UGX)
              th(scope='col') Total Cost
              th(scope='col') Supplier Name 
              th(scope='col') Date
              th(scope='col') View
              th(scope='col') Update 
              th(scope='col') Delete

          tbody#productTable
            if items.length 
              each item in items
                tr(data-type=item.productType)
                  td #{item.productName}
                  td #{item.productType} 
                  td #{item.quantity}
                  td #{item.costPrice}
                  td #{item.productPrice}
                  td #{item.totalCost.toLocaleString()}
                  td #{item.supplierName}
                  td #{moment(item.dateBought).format("DD-MM-YYYY")}

                  //- View Button
                  td
                    button.btn.btn-info.p-2(
                      type='button'
                      data-bs-toggle="modal"
                      data-bs-target=`#viewModal-${item._id}`
                    )
                      i.bi.bi-eye-fill

                  //- Update Button
                  td 
                    a.btn.btn-warning(href=`/editstock/${item._id}`)
                      i.bi.bi-pencil-fill  

                  //- Delete Button
                  td 
                    button.btn.btn-danger.p-2(
                      type='button'
                      data-bs-toggle="modal"
                      data-bs-target=`#deleteModal-${item._id}`
                    )
                      i.bi.bi-trash-fill  

                  //- Delete Modal
                  div.modal.fade(id=`deleteModal-${item._id}` tabindex="-1" aria-hidden="true")
                    .modal-dialog
                      .modal-content
                        .modal-header
                          h5.modal-title Delete Confirmation
                          button.btn-close(type="button" data-bs-dismiss="modal")
                        .modal-body
                          p Are you sure you want to delete "#{item.productName}"?
                        .modal-footer
                          button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Cancel
                          form(method='post' action="/deletestock")
                            input(type="hidden" name='id' value=item._id)
                            button.btn.btn-danger(type='submit') Confirm Delete    

                  //- View Modal
                  div.modal.fade(id=`viewModal-${item._id}` tabindex="-1" aria-hidden="true")
                    .modal-dialog
                      .modal-content
                        .modal-header
                          h5.modal-title Stock Details
                          button.btn-close(type="button" data-bs-dismiss="modal")
                        .modal-body
                          ul.list-group
                            li.list-group-item
                              strong Name: 
                              | #{item.productName}
                            li.list-group-item
                              strong Type: 
                              | #{item.productType}
                            li.list-group-item
                              strong Quantity: 
                              | #{item.quantity}
                            li.list-group-item
                              strong Cost Price: 
                              | #{item.costPrice}
                            li.list-group-item
                              strong Total Cost: 
                              | #{item.totalCost.toLocaleString()}
                            li.list-group-item
                              strong Product Price: 
                              | #{item.productPrice}
                            li.list-group-item
                              strong Supplier: 
                              | #{item.supplierName}
                            li.list-group-item
                              strong Date: 
                              | #{moment(item.dateBought).format("DD-MM-YYYY")}
                            li.list-group-item
                              strong Quality: 
                              | #{item.quality}
                            li.list-group-item
                              strong Color: 
                              | #{item.color}
                            li.list-group-item
                              strong Measurements: 
                              | #{item.measurements}
                            li.list-group-item
                              strong Phone: 
                              | #{item.phoneNumber}
                        .modal-footer
                          button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Close
            else
              tr
                td(colspan="15" class="text-center text-muted")
                  | No products available. 
                  a(href='/stock' class='btn btn-sm btn-primary ms-2') Add Stock Now

      script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js')
      script(src='/js/stocktable2.js')
